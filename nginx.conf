server {
    listen 8080;

    #######################################################
    # üá∑üá∫ –û—Å–Ω–æ–≤–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç (/)
    #######################################################
    location / {
        proxy_pass https://backend1;
        proxy_http_version 1.1;

        proxy_ssl_verify off;
        proxy_ssl_server_name on;

        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
        proxy_set_header Host $host;

        proxy_read_timeout 86400;
        proxy_send_timeout 86400;
    }

    #######################################################
    # üá∫üá∏ –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç (/usa)
    #######################################################
    location /usa {
        proxy_pass https://backend2;
        proxy_http_version 1.1;

        # --- TLS + SNI ---
        proxy_ssl_verify off;                     # —Ä–∞–∑—Ä–µ—à–∞–µ–º —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
        proxy_ssl_server_name on;                 # –≤–∫–ª—é—á–∞–µ–º –ø–µ—Ä–µ–¥–∞—á—É SNI
        proxy_ssl_name video.up.railway.app;      # –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å Xray -> "serverName"

        # --- WebSocket Upgrade ---
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection $connection_upgrade;
        proxy_set_header Host video.up.railway.app;

        # --- –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ---
        proxy_read_timeout 86400;
        proxy_send_timeout 86400;
    }
}
